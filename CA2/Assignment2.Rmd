---
title: "Assignment II"
subtitle: "Logistic regression"
author: "Silpa Soni Nallacheruvu (19980824-5287) Hernan Aldana (20000526-4999)"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
```

---

# Exercise 2:1

This report analyses the data on periodontitis from a group of adult patients at a large dental clinic.
The goal is to understand the influence of the parameter estimates between logistic regression models of the probability for periodontitis in the population as a function of dental floss use and the probability for using dental floss as a function of periodontitis status. 

```{r echo=FALSE, fig.align='center'}

# Create the 2x2 table
periodontitis_table <- matrix(
  c(22, 75, 148, 265, 97, 413, 170, 340, 510), # Data including margins
  nrow = 3,                                   # Three rows: Yes, No, Sum
  byrow = TRUE,                               # Fill matrix by rows
  dimnames = list(
    `Dental Floss Use` = c("Used Dental Floss", "Not Used Dental Floss", "Total"), # Row names
    `Periodontitis` = c("Periodontitis", "No Periodontitis", "Total")    # Column names
  )
)

# Convert to data frame for better printing
periodontitis_df <- as.data.frame.matrix(periodontitis_table)

# Use kable to display the table
kable(
  periodontitis_df,
  caption = "Regular Use of Dental Floss and Periodontitis",
  align = "c"
)

```

## Question 1: Logistic regression model of the probability for periodontitis

The logistic regression model of the probability for periodontitis in the population as a function of dental floss use is defined as:

$\text{logit}(p_x) = \log\left(\frac{p_x}{1 - p_x}\right) = \beta_0 + \beta_1 x$

where:

- $x$ = 1 if dental floss is regularly used, $x$ = 0 otherwise.
- $p_x$ = $P(\text{periodontitis} \mid x)$, the probability of periodontitis given $x$.
- $\beta_0$: The log-odds of periodontitis when $x$ = 0 (no floss use).
- $\beta_1$: The change in log-odds of periodontitis when $x$ changes from 0 to 1 (effect of using floss).
	
### Approach:

Fit the logistic regression model to the data and interpret the parameter estimates.

### Estimate Parameters:

**1. Fit the logistic regression model:**

The summary of the logistic regression model coefficients is presented below:

```{r echo=FALSE}
# Prepare data
dental_data <- data.frame(
  floss = c(1, 0), # 1 = yes, 0 = no
  periodontitis_yes = c(22, 148),
  periodontitis_no = c(75, 265)
)

# Logistic regression
model <- glm(cbind(periodontitis_yes, periodontitis_no) ~ floss, 
             family = binomial(link=logit), data = dental_data)

# Extract model coefficients summary
model_summary <- summary(model)

# Create a data frame with relevant data
coefficients_table <- data.frame(
  Term = rownames(model_summary$coefficients),
  Estimate = model_summary$coefficients[, "Estimate"],
  `Std. Error` = model_summary$coefficients[, "Std. Error"],
  `z value` = model_summary$coefficients[, "z value"],
  `Pr(>|z|)` = model_summary$coefficients[, "Pr(>|z|)"]
)

# Print the table using kable
kable(
  coefficients_table,
  caption = "Summary of Logistic Regression Model Coefficients",
  align = c("l", "c", "c", "c", "c"),
  col.names = c("Term", "Estimate", "Std. Error", "z value", "P-value")
)
```

**2. Expected Estimates of the parameters:**

2.1.	Intercept $(\beta_0)$:

- $\beta_0$ represents the log-odds of periodontitis when $x$ = 0 (no dental floss use):
    $\beta_0 = \log\left(\frac{p_0}{1 - p_0}\right)$ where:
    $p_0 = \frac{\text{Periodontitis (No Floss)}}{\text{Total (No Floss)}} = \frac{148}{413} \approx 0.3585$

- Hence: $\beta_0 \approx \log\left(\frac{0.3585}{1 - 0.3585}\right) = \log(0.558) \approx -0.583$

2.2.	Slope $(\beta_1)$:

- $\beta_1$ represents the change in log-odds when $x$ = 1 (dental floss is used):
        $\beta_1 = \log\left(\frac{p_1}{1 - p_1}\right) - \log\left(\frac{p_0}{1 - p_0}\right)$ where:
$p_1 = \frac{\text{Periodontitis (Floss)}}{\text{Total (Floss)}} = \frac{22}{97} \approx 0.2268$

- Hence:
      $\beta_1 \approx \log\left(\frac{0.2268}{1 - 0.2268}\right) - \log\left(\frac{0.3585}{1 - 0.3585}\right) \approx \log(0.293) - \log(0.558) = -1.229 + 0.583 = -0.646$

The final logistic regression equation: $\text{logit}(p_x) = -0.583 - 0.646x$

### Interpret Parameters:

- 1.	$\beta_0$ = -0.583:
  - The log-odds of periodontitis for individuals who do not use dental floss is approximately -0.583.
  - The corresponding probability of periodontitis is: 
  $p_0 = \frac{e^{-0.583}}{1 + e^{-0.583}} \approx 0.358$

- 2.	$\beta_1$ = -0.646:
  - The log-odds of periodontitis decreases by 0.646 when individuals use dental floss regularly.
  - This corresponds to an odds ratio of:
  $\text{Odds Ratio} = e^{\beta_1} = e^{-0.646} \approx 0.524$

Individuals who use dental floss regularly have approximately 52.4% lower odds of developing periodontitis compared to those who do not.

### Conclusion: 

- The logistic regression model provides interpretable estimates of the effect of dental floss use on periodontitis.
- Regular dental floss use is associated with a significant reduction in the odds of periodontitis.
- The logistic regression model is appropriate because the data is binary (periodontitis: yes/no) and the explanatory variable (dental floss use) is categorical.

## Question 2: Logistic regression model of the probability for using dental floss

### Approach : 

### R Output :

```{r echo=FALSE}

```

## Observation : 


## Question 3: 

### Approach : 

### R Output :

```{r echo=FALSE}

```

## Observation : 

---

# Exercise 2:2
## Question 1:

For this question we estimate for each dose separately the risk, odds, and log-odds of developing a tumor. Also plot the risk (probability) of developing a tumor as a function of the log dose. Calculate the log-odds of developing a tumor and plot it as a function of the log dose. 

```{r echo=FALSE}
# Data from the instructions
log_dose <- c(-7.60, -6.22, -4.60, -3.00, -1.39, 0.92)
tumor <- c(1, 2, 4, 9, 12, 32)
no_tumor <- c(17, 17, 24, 23, 16, 8)
total <- tumor + no_tumor

# Create the table
original_table <- data.frame(
  `log(dose)` = log_dose,
  Tumor = tumor,
  `No tumor` = no_tumor,
  `Total` = total
)
t_table<- t(original_table)
# Display the table
knitr::kable(t_table, caption = "Original Data Table")
```

### Approach : 
To answer these questions we have to calculate the following estimates for each dose level of the table:

1. The risk of developing a tumor is calculated as:

  $Risk = \frac{Number of Tumor}{Total Observations}$

2. The odds of developing a tumor is calculated as:

  $Odds = \frac{Risk}{1 - Risk}$

3. The log-odds of developing a tumor is calculated as:

  $\log(Odds) = \log(\frac{Risk}{1-Risk})$

After we caclulate these estimates for each dose level, we  plot the risk (probability) of developing a tumor as a function of the log dose. We  also calculate the log-odds of developing a tumor and plot it as a function of the log dose.

### Results

```{r echo=FALSE}
# Calculate risk (probability) of tumor
risk <- tumor / total

# Calculate odds
odds <- risk / (1 - risk)

# Calculate log-odds
log_odds <- log(odds)

updated_table <- data.frame(
  `log(dose)` = log_dose,
  Tumor = tumor,
  `No tumor` = no_tumor,
  Total = total,
  Risk = round(risk, 4),
  Odds = round(odds, 4),
  `Log-Odds` = round(log_odds, 4)
)
t_updated_table<- t(updated_table)
knitr::kable(t_updated_table, caption = "Original Data Table with Risk, Odds, and Log-Odds Calculations")

```
1. Data

  - As we can observe from the updated table and from the given data, at lower doses of BaP, few mice develop tumors, while most do not. As the dose increases, the risk of developing a tumor also increases.

2. Risk

  - Risk represents the probability of developing a tumor, and for the given data it increases with $\log(dose)$. As for the calculated estimates, the risk is very low(0.0556) for the lowest dose of BaP(-7.60), indicating a small proportion of tumors.  At the highest dose (0.92) the risk is much higher(0.8), showing a significant increase in the development of tumors. 

3. Odds

  - Odds, which represent the ratio of tumor probability to no-tumor probability, increases expontentially with dose. The odds are very low(0.0588) for the lowest dose of BaP(-7.60), indicating a very low probability of developing a tumor. This means that tumors are 0.0588 as likely as no tumors. At the highest dose (0.92) the odds are much higher(4), showing a significant increase in the development of tumors. Meaning that tumors are four times more likely than no tumors at the given dose.
  
4. Log-Odds

  - Log-Odds increase nearly linearly with log(dose), ranging from -2.8332 at the lowest dose to 1.3863 at the highest. The linearity in log-odds is imperative, as it supports the use of a logistic regression.
  


```{r echo=FALSE}

# Create an updated table with the new calculations
updated_table <- data.frame(
  `log(dose)` = log_dose,
  Tumor = tumor,
  `No tumor` = no_tumor,
  Total = total,
  Risk = round(risk, 4),
  Odds = round(odds, 4),
  `Log-Odds` = round(log_odds, 4)
)

# Plot Risk (Probability) vs log(dose)
plot(log_dose, risk, type = "b", col = "blue", pch = 19,
     xlab = "log(Dose)", ylab = "Risk (Probability)",
     main = "Risk vs log(Dose)")
grid()
```

1. Risk vs log(dose) 

  - The graph confirms a strong dose response relationship. As log(dose) increases, the probability of developing a tumor increases rapidly.
  


```{r echo=FALSE}
# Plot Log-Odds vs log(dose)
plot(log_dose, log_odds, type = "b", col = "red", pch = 19,
     xlab = "log(Dose)", ylab = "Log-Odds",
     main = "Log-Odds vs log(Dose)")
grid()
```

2. Log-Odds vs log(dose)

  - The graph shows a nearly linear relationship with log(dose) confirming that the data aligns well with the assumptions of logistic regression. 
  
### Conclusion

The analysis confirms a strong dose response relationship between the dose of BaP and the probability of developing a tumor. As the dose or log(dose) increases, the risk and odds of tumor development also increase as shown in the "Risk vs. log(dose)" plot. The near linear relationship in the "Log-Odds vs. log(dose)" plot supports the use of logistic regression to model the data.


## Question 2

Fit a logistic regression model to the data and interpret the parameter estimates, particularly the slope parameter.

### Approach :

To answer this question, we fit a logistic regression model where the probability of developing a tumor($P$) is modeled as:

$\text{logit}(P) = \log\left(\frac{P}{1 - P}\right) = \beta_0 + \beta_1 \times \text{log(dose})$

where:
  
  - $\beta_{0}$ is the intercept, which represents the log-odds of developing a tumor when the dose is zero.
  
  - $\beta_{1}$ is the slope parameter, which represents the change in log-odds of developing a tumor for a one-unit increase in the log dose.

We will use the logistic regression model to estimate this parameters.
### Results :

```{r echo=FALSE}
# Fit a logistic regression model
model <- glm(cbind(tumor, no_tumor) ~ log_dose, family = binomial)

# Summary of the model
summary(model)
```

```{r echo=FALSE}
# Generate fitted values for plotting
new_dose <- seq(min(log_dose), max(log_dose), length.out = 100)
predicted_risk <- predict(model, newdata = data.frame(log_dose = new_dose), type = "response")

# Add fitted curve to the risk plot
plot(log_dose, risk, type = "b", col = "blue", pch = 19,
     xlab = "log(Dose)", ylab = "Risk (Probability)",
     main = "Risk vs log(Dose) with Logistic Fit")
lines(new_dose, predicted_risk, col = "darkgreen", lwd = 2, lty = 2)
legend("topleft", legend = c("Observed Risk", "Fitted Logistic Curve"),
       col = c("blue", "darkgreen"), lty = c(1, 2), lwd = c(1, 2), pch = c(19, NA))
grid()
```
1. Intercept $\beta_0$

According to the summary of the model, the intercept $\beta_{0}$ is 0.687. This represent the log-odds of developing a tumor when the dose is zero. Its corresponding odd are $e^{0.687} = 1.99$. This means that the odds of developing a tumor are nearly twice as high as the odds of not developing a tumor when the log(dose) is zero.

Translating this to probabilities, the probability of developing a tumor is $P = \frac{e^{0.687}}{1 + e^{0.687}} = 0.665$. This means that the probability of developing a tumor is 66.5% when the dose is zero.

2. Slope $\beta_1$

The slope parameter $\beta_{1}$ is 0.52037. This quantifies the change in the log-odds of developing a tumor for a one-unit increase in log(dose). A positive slope indicates that higher doses increase the odds of developing a tumor. the odds ario is $e^{0.52037}\approx1.683$

This means that for each one-unit increase in log(dose), the odds of developing a tumor increases by approximately 68.3%


### Conclusion :

In conclusion, the logistic regression model reveals a clear relationship between log(dose) and the probability of developing a tumor. The intercept $\beta_{0}$ represents the log-odds of developing a tumor when the log(dose) is zero, while the slope $\beta_{1}$ quantifies the change in log-odds for a one-unit increase in log(dose). The positive slope indicates that higher doses increase the odds of developing a tumor. The fitted logistic curve aligns well with the observed risk, confirming the appropriateness of the logistic regression model.

## Question 3


### Approach :

### Results :

### Conclusion :
